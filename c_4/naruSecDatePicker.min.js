function NaruDateTimePicker(a,b){this.$selector=null;this.selectorSt=null;this.selectorEd=null;this._eventTarget=null;this.options=null;this.message={ko:{stTitle:"시작일",edTitle:"종료일",okBtn:"확인",closeBtn:"닫기",maxMessage:function(c){return"최대 설정 범위는 "+c+"일 입니다."},notAvailableMessage:"이후로 설정하실 수 없습니다."},en:{stTitle:"Start date",edTitle:"End date",okBtn:"ok",closeBtn:"close",maxMessage:function(c){return"Max Range "+c+"day(s)"},notAvailableMessage:"after that is not avaliable."}};this._initOptions(b);this._init(a);let objThis=this;return{initDate:function(){return objThis.initDate.apply(objThis,arguments)},setDate:function(){return objThis.setDate.apply(objThis,arguments)},getDate:function(){return objThis.getDate.apply(objThis,arguments)},getTime:function(){return objThis.getTime.apply(objThis,arguments)},changeStDateByEd:function(){return objThis.changeStDateByEd.apply(objThis,arguments)},clearDate:function(){return objThis.clearDate.apply(objThis)}}}NaruDateTimePicker.debug=false;NaruDateTimePicker.defaultOptions={locale:"ko",inputSt:null,inputEd:null,inlineFlag:false,originPattern:"YYYYMMDDHHmm",selectorPattern:"YYYY-MM-DD HH:mm",minRange:0,maxRange:null,maxDate:null,tooltip:null,hideEvent:null};(function(){this._init=function(a){if(!a){return}this.$selector=$(a);if(!this.$selector[0]){return}this._initDraw();this._initEvent();this._initValue()};this._initOptions=function(a){this.options=$.extend({},NaruDateTimePicker.defaultOptions,a);if(!$("#"+this.options.inputSt)[0]){console.error("invalid inputSt id");return}if(!$("#"+this.options.inputEd)[0]){console.error("invalid inputEd id");return}this.selectorSt=this.options.inputSt+"Time";this.selectorEd=this.options.inputEd+"Time"};this._initDraw=function(){let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let $inputSt=this.$selector.find("#"+inputSt);let $inputEd=this.$selector.find("#"+inputEd);$inputSt.addClass("naru-calendar-input");$inputEd.addClass("naru-calendar-input");let calWrapperSt=$("<div class='input-group naru-calendar-wrapper'></div>");let calWrapperEd=$("<div class='input-group naru-calendar-wrapper'></div>");calWrapperSt.attr("id",this.selectorSt);calWrapperEd.attr("id",this.selectorEd);$inputSt.wrap(calWrapperSt);$inputEd.wrap(calWrapperEd);let calWrapper=this.$selector.find(".naru-calendar-wrapper");calWrapper.each(function(){let spanIcon=$("<span class='input-group-addon input-group-append naru-calendar-icon'></span>");spanIcon.append("<span class='input-group-text glyphicon glyphicon-calendar'></span>");$(this).append(spanIcon)});this.createPicker();let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $stDateTimePicker=this._getDateTimePicker(selectorSt);let $edDateTimePicker=this._getDateTimePicker(selectorEd);$("#"+inputSt).on("click",function(){$stDateTimePicker.toggle()});$("#"+inputEd).on("click",function(){$edDateTimePicker.toggle()})};this._initEvent=function(){let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $selectorSt=$("#"+selectorSt);let $selectorEd=$("#"+selectorEd);let selectorPattern=this.options.selectorPattern;let $stDateTimePicker=this._getDateTimePicker(selectorSt);let $edDateTimePicker=this._getDateTimePicker(selectorEd);let hideEvent=this.options.hideEvent;let objThis=this;$selectorSt.on("dp.error",function(a){if(NaruDateTimePicker.debug){console.error("st dp error invalid date: "+moment(a.date).format())}});$selectorEd.on("dp.error",function(a){if(NaruDateTimePicker.debug){console.error("ed dp error invalid date: "+moment(a.date).format())}});$selectorSt.on("dp.change",function(a){if(moment(a.date,selectorPattern).isValid()){objThis._eventTarget=a.target.id;$edDateTimePicker.minDate(a.date)}});$selectorEd.on("dp.change",function(a){if(moment(a.date,selectorPattern).isValid()){objThis._eventTarget=a.target.id;if(selectorPattern==="YYYY-MM-DD"){$stDateTimePicker.maxDate(moment(a.date).hours(23).minutes(59).seconds(59))}else{$stDateTimePicker.maxDate(a.date)}}});if(objThis.constructor===NaruDateTimePicker){$selectorSt.on("dp.hide",function(){objThis._checkRange();if(hideEvent!==null&&typeof hideEvent==="function"){hideEvent()}});$selectorEd.on("dp.hide",function(){objThis._checkRange();if(hideEvent!==null&&typeof hideEvent==="function"){hideEvent()}})}};this._checkRange=function(){let check=false;let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let eventTarget=this._eventTarget;let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let $inputSt=$("#"+inputSt);let $inputEd=$("#"+inputEd);let maxRange=this.options.maxRange;let minRange=this.options.minRange;let tooltip=this.options.tooltip;let locale=this.options.locale;if(this.getDiff("m")<minRange){if(!eventTarget||eventTarget===selectorEd){check=this.changeStDateByEd(-1*minRange,"m")}else{if(eventTarget===selectorSt){check=this._changeEdDateBySt(minRange,"m")}}}if(maxRange!=null&&this.getDiff("m")>maxRange){let maxMessage=this.message[locale].maxMessage(maxRange/60/24);let placement=tooltip!=null&&tooltip.hasOwnProperty("placement")?tooltip.placement:"bottom";let title=tooltip!=null&&tooltip.hasOwnProperty("title")?tooltip.title:maxMessage;if(!eventTarget||eventTarget===selectorEd){this._showTooltip($inputSt,{title:title,placement:placement});check=this.changeStDateByEd(-1*maxRange,"m")}else{if(eventTarget===selectorSt){this._showTooltip($inputEd,{title:title,placement:placement});check=this._changeEdDateBySt(maxRange,"m")}}}return check};this.createPicker=function(){let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $selectorSt=$("#"+selectorSt);let $selectorEd=$("#"+selectorEd);let locale=this.options.locale;let selectorPattern=this.options.selectorPattern;let inlineFlag=!(this.constructor===NaruDateTimePicker);$selectorSt.datetimepicker({locale:locale,format:selectorPattern,useCurrent:false,inline:inlineFlag});$selectorEd.datetimepicker({locale:locale,format:selectorPattern,useCurrent:false,inline:inlineFlag})};this._initValue=function(){let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let originPattern=this.options.originPattern;let $inputSt=$("#"+inputSt);let $inputEd=$("#"+inputEd);let stValue=$inputSt.val();let edValue=$inputEd.val();let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $stDateTimePicker=this._getDateTimePicker(selectorSt);let $edDateTimePicker=this._getDateTimePicker(selectorEd);if(NaruDateTimePicker.debug){console.log("_initValue user first",stValue,edValue)}let stMoment=null;if(stValue!==undefined&&stValue!==""&&moment(stValue,originPattern).isValid()){stMoment=moment(stValue,originPattern)}else{$stDateTimePicker.clear();stMoment=$stDateTimePicker.date()}let edMoment=null;if(edValue!==undefined&&edValue!==""&&moment(edValue,originPattern).isValid()){edMoment=moment(edValue,originPattern)}else{$edDateTimePicker.clear();edMoment=$edDateTimePicker.date()}this.checkValidation(stMoment,edMoment)};this.setDate=function(){let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let selectorPattern=this.options.selectorPattern;let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $stDateTimePicker=this._getDateTimePicker(selectorSt);let $edDateTimePicker=this._getDateTimePicker(selectorEd);let $inputSt=$("#"+inputSt);let $inputEd=$("#"+inputEd);let stValue=$inputSt.val();let edValue=$inputEd.val();if(NaruDateTimePicker.debug){console.log("setDate user first",stValue,edValue)}let stMoment=null;if(stValue!==undefined&&stValue!==""&&moment(stValue,selectorPattern).isValid()){stMoment=moment(stValue,selectorPattern)}else{$stDateTimePicker.clear()}let edMoment=null;if(edValue!==undefined&&edValue!==""&&moment(edValue,selectorPattern).isValid()){edMoment=moment(edValue,selectorPattern)}else{$edDateTimePicker.clear()}this.checkValidation(stMoment,edMoment)};this.checkValidation=function(a,b){let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let maxDate=this.options.maxDate;let originPattern=this.options.originPattern;let selectorPattern=this.options.selectorPattern;let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $stDateTimePicker=this._getDateTimePicker(selectorSt);let $edDateTimePicker=this._getDateTimePicker(selectorEd);let $inputSt=$("#"+inputSt);let $inputEd=$("#"+inputEd);if(a!==null&&b!==null){$edDateTimePicker.minDate(false);$edDateTimePicker.maxDate(false);$stDateTimePicker.minDate(false);$stDateTimePicker.maxDate(false);if(a.diff(b)>0){if(NaruDateTimePicker.debug){console.log("_initValue st > ed",a.format(selectorPattern),b.format(selectorPattern))}b=a}let maxDateMoment=b;if(maxDate==="today"){maxDateMoment=moment()}if(maxDate&&moment(maxDate,originPattern).isValid()){maxDateMoment=moment(maxDate,originPattern);maxDateMoment.hours(23).minutes(59).seconds(59);let placement="bottom";if(b!=null&&b.diff(maxDateMoment)>0){b=maxDateMoment;let title=b.format(selectorPattern)+" 이후로 설정하실 수 없습니다.";this._showTooltip($inputEd,{title:title,placement:placement});if(NaruDateTimePicker.debug){console.log("check user maxdate > ed",b.format())}}if(a!=null&&a.diff(maxDateMoment)>0){a=maxDateMoment;let title=a.format(selectorPattern)+" 이후로 설정하실 수 없습니다.";this._showTooltip($inputSt,{title:title,placement:placement});if(NaruDateTimePicker.debug){console.log("check user maxdate > st",a.format())}}$edDateTimePicker.maxDate(maxDateMoment);$stDateTimePicker.maxDate(maxDateMoment)}$edDateTimePicker.minDate(a);let changeSt=a.format(selectorPattern);$inputSt.val(changeSt);let changeEd=b.format(selectorPattern);$inputEd.val(changeEd);$stDateTimePicker.date(changeSt);$stDateTimePicker.viewDate(changeSt);$stDateTimePicker.locale($stDateTimePicker.locale());$edDateTimePicker.date(changeEd);$edDateTimePicker.viewDate(changeEd);$edDateTimePicker.locale($edDateTimePicker.locale())}};this.getAddDate=function(a,c,b){let selectorPattern=this.options.selectorPattern;let resultDate=null;let mDate=moment($("#"+a).data("date"),selectorPattern);if(mDate.isValid()){if(selectorPattern==="YYYY-MM-DD"){mDate.hours(23).minutes(59).seconds(59)}let check=mDate.add(c,b).isValid();if(check){if(selectorPattern==="YYYY-MM-DD"){mDate.add(1,"s")}resultDate=mDate.format(selectorPattern)}}if(resultDate==null){if(NaruDateTimePicker.debug){console.log("invalid getAddDate")}}return resultDate};this.getMoment=function(a){let selectorPattern=this.options.selectorPattern;let mDate=moment($("#"+a).data("date"),selectorPattern);if(!mDate.isValid()){mDate=null}if(mDate==null){if(NaruDateTimePicker.debug){console.log("invalid getMoment")}}return mDate};this._getDate=function(a,b){let selector=this._getSelector(a);let dateTimePicker=this._getDateTimePicker(selector);let $objInput=$("#"+a);let selectorPattern=this.options.selectorPattern;let result="";if(dateTimePicker===undefined){result="";$objInput.val(result)}else{if(b){if(moment(dateTimePicker.date(),b).isValid()){result=dateTimePicker.date().format(b)}}else{result=dateTimePicker.date().format(selectorPattern)}$objInput.val(dateTimePicker.date().format(selectorPattern))}return result};this.getDate=function(a,b){let selectorPattern=this.options.selectorPattern;let $objInput=$("#"+a);let value=$objInput[0]===undefined?"":$objInput.val();let result="";if(value!==""){if(moment(value,selectorPattern).isValid()){result=moment(value,selectorPattern).format(b)}else{result=this._getDate(a,b)}}return result};this.getTime=function(a){let $objInput=$("#"+a);let value=$objInput[0]===undefined?"":$objInput.val();let result=0;if(value!==""){let selector=this._getSelector(a);let dateTimePicker=this._getDateTimePicker(selector);result=dateTimePicker.date().toDate().getTime()}return result};this._getSelector=function(a){let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let gSelector=null;if(a===inputSt){gSelector=this.selectorSt}if(a===inputEd){gSelector=this.selectorEd}return gSelector};this._getDateTimePicker=function(a){return $("#"+a).data("DateTimePicker")};this.getDiff=function(a){let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $stDateTimePicker=this._getDateTimePicker(selectorSt);let $edDateTimePicker=this._getDateTimePicker(selectorEd);let selectorPattern=this.options.selectorPattern;let dateDiff=0;if(undefined!==$stDateTimePicker&&undefined!==$edDateTimePicker){if(selectorPattern==="YYYY-MM-DD"){dateDiff=moment($edDateTimePicker.date(),selectorPattern).hours(23).minutes(59).seconds(59)-moment($stDateTimePicker.date(),selectorPattern).hours(0).minutes(0).seconds(0)}else{dateDiff=$edDateTimePicker.date()-$stDateTimePicker.date()}}if(a){switch(a){case"d":dateDiff=Math.ceil(dateDiff/(1000*60*60*24));break;case"h":dateDiff=Math.ceil(dateDiff/(1000*60*60));break;case"m":dateDiff=Math.ceil(dateDiff/(1000*60));break;case"s":dateDiff=Math.ceil(dateDiff/1000);break;default:break}}return dateDiff};this.initDate=function(a){let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let $inputSt=$("#"+inputSt);let $inputEd=$("#"+inputEd);if(a instanceof Object&&(a.hasOwnProperty(inputSt)||a.hasOwnProperty(inputEd))){if(a.hasOwnProperty(inputSt)){$inputSt.val(a[inputSt])}if(a.hasOwnProperty(inputEd)){$inputEd.val(a[inputEd])}this.setDate()}};this.clearDate=function(){let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let $inputSt=$("#"+inputSt);let $inputEd=$("#"+inputEd);$inputSt.val("");$inputEd.val("");this.setDate()};this.changeStDateByEd=function(a,b){let selectorEd=this.selectorEd;let inputSt=this.options.inputSt;let number=parseInt(a);let check=false;if(!isNaN(number)&&number!==0){let changeDate=this.getAddDate(selectorEd,number,b);if(changeDate!=null){$("#"+inputSt).val(changeDate);this.setDate();check=true}}return check};this._changeEdDateBySt=function(a,b){let selectorSt=this.selectorSt;let inputEd=this.options.inputEd;let number=parseInt(a);let check=false;if(!isNaN(number)&&number!==0){let changeDate=this.getAddDate(selectorSt,number,b);if(changeDate!=null){$("#"+inputEd).val(changeDate);this.setDate();check=true}}return check};this._showTooltip=function(a,b){if(typeof a.bstooltip!=="function"){a.bstooltip=a.tooltip}let $parent=a.parent();let inputId=a.attr("id");let tooltipOptions={title:b.title,placement:b.placement,trigger:"manual"};let tooltipId="";if($parent.length>0){if(this.constructor===NaruDateTimeMultiPicker){tooltipId=inputId+"ToolTip";$parent.attr("id",tooltipId)}tooltipOptions.container="#"+$parent.attr("id")}a.bstooltip(tooltipOptions);a.bstooltip("show");a.on("shown.bs.tooltip",function(){setTimeout(function(){a.bstooltip("hide");a.bstooltip("dispose");if(tooltipId!==""){$parent.removeAttr("id")}},2000)})}}).call(NaruDateTimePicker.prototype);function NaruDateTimeMultiPicker(a,b){arguments[1]=$.extend({},NaruDateTimeMultiPicker.defaultOptions,b);return NaruDateTimePicker.apply(this,arguments)}let NaruDateTimePickerTemp=function(){};NaruDateTimePickerTemp.prototype=NaruDateTimePicker.prototype;NaruDateTimeMultiPicker.prototype=new NaruDateTimePickerTemp();NaruDateTimeMultiPicker.prototype.constructor=NaruDateTimeMultiPicker;NaruDateTimeMultiPicker.defaultOptions={locale:"ko",inputSt:null,inputEd:null,inlineFlag:true,originPattern:"YYYYMMDDHHmm",selectorPattern:"YYYY-MM-DD HH:mm",minRange:0,maxRange:null,confirmEvent:null};NaruDateTimeMultiPicker.prototype._initDraw=function(){let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $inputSt=this.$selector.find("#"+inputSt);let $inputEd=this.$selector.find("#"+inputEd);$inputSt.addClass("naru-calendar-input");$inputEd.addClass("naru-calendar-input");let calWrapperSt=$("<div class='input-group naru-calendar-wrapper'></div>");let calWrapperEd=$("<div class='input-group naru-calendar-wrapper'></div>");$inputSt.wrap(calWrapperSt);$inputEd.wrap(calWrapperEd);let calWrapper=this.$selector.find(".naru-calendar-wrapper");calWrapper.each(function(){let spanIcon=$("<span class='input-group-addon input-group-append naru-calendar-icon'></span>");spanIcon.append("<span class='input-group-text glyphicon glyphicon-calendar'></span>");$(this).append(spanIcon)});let locale=this.options.locale;let stTitle=this.message[locale].stTitle;let edTitle=this.message[locale].edTitle;let okBtn=this.message[locale].okBtn;let closeBtn=this.message[locale].closeBtn;let $dateLayer=$("<div class='naru-date-layer'></div>");let $dateBoxSt=$("<div class='naru-date-box'></div>");let $dateTitleSt=$("<div class='naru-date-title'></div>");$dateTitleSt.append(stTitle);let $dateContentSt=$("<div class='naru-date-content'></div>");let $objDaySt=$("<div></div>");$objDaySt.attr("id",selectorSt);$dateContentSt.append($objDaySt);$dateBoxSt.append($dateTitleSt);$dateBoxSt.append($dateContentSt);let $dateBoxEd=$("<div class='naru-date-box'></div>");let $dateTitleEd=$("<div class='naru-date-title'></div>");$dateTitleEd.append(edTitle);let $dateContentEd=$("<div class='naru-date-content'></div>");let $objDayEd=$("<div></div>");$objDayEd.attr("id",selectorEd);$dateContentEd.append($objDayEd);$dateBoxEd.append($dateTitleEd);$dateBoxEd.append($dateContentEd);let $dateBtnLayer=$("<div class='naru-date-btn-layer'></div>");let $confirmBtn=$("<span class='btn btn-outline-dark naru-date-confirm-btn'>"+okBtn+"</span>");let $closeBtn=$("<span class='btn btn-outline-dark naru-date-close-btn'>"+closeBtn+"</span>");$dateBtnLayer.append($confirmBtn);$dateBtnLayer.append($closeBtn);$dateLayer.append($dateBoxSt);$dateLayer.append($dateBoxEd);$dateLayer.append($dateBtnLayer);this.$selector.append($dateLayer);this.createPicker()};NaruDateTimeMultiPicker.prototype._initEvent=function(){NaruDateTimePicker.prototype._initEvent.call(this);let selectorPattern=this.options.selectorPattern;let selectorSt=this.selectorSt;let selectorEd=this.selectorEd;let $stDateTimePicker=this._getDateTimePicker(selectorSt);let $edDateTimePicker=this._getDateTimePicker(selectorEd);let dateLayerClass="naru-date-layer";let $dateLayerSelector=this.$selector.find("."+dateLayerClass);let inputSt=this.options.inputSt;let inputEd=this.options.inputEd;let $inputSt=$("#"+inputSt);let $inputEd=$("#"+inputEd);let objThis=this;$inputSt.on("keyup",function(){if(moment($(this).val(),selectorPattern,true).isValid()){$(this).data({origin:$(this).val()})}else{let data=$(this).data();if(!data.hasOwnProperty("origin")){$(this).data({origin:$stDateTimePicker.date().format(selectorPattern)})}}});$inputSt.on("focusout",function(){let data=$(this).data();if(data.hasOwnProperty("origin")){$(this).val(data.origin);objThis.checkValidation(moment($(this).val(),selectorPattern),$edDateTimePicker.date());delete data.origin}});$inputEd.on("keyup",function(){if(moment($(this).val(),selectorPattern,true).isValid()){$(this).data({origin:$(this).val()})}else{let data=$(this).data();if(!data.hasOwnProperty("origin")){$(this).data({origin:$edDateTimePicker.date().format(selectorPattern)})}}});$inputEd.on("focusout",function(){let data=$(this).data();if(data.hasOwnProperty("origin")){objThis.checkValidation($stDateTimePicker.date(),moment($(this).val(),selectorPattern));delete data.origin}});this.$selector.find(".naru-date-confirm-btn").on("click",$.proxy(function(b){b.stopPropagation();let confirmEvent=this.options.confirmEvent;let stDate=$stDateTimePicker.date();let edDate=$edDateTimePicker.date();if(stDate!=null){$inputSt.val(stDate.format(selectorPattern))}if(edDate!=null){$inputEd.val(edDate.format(selectorPattern))}let check=this._checkRange();if(!check){this.setDate()}$dateLayerSelector.hide(0,function(){$(document).off("click.narusec-date-picker")});if(confirmEvent!==null&&typeof confirmEvent==="function"){confirmEvent()}},this));this.$selector.find(".naru-date-close-btn").on("click",$.proxy(function(b){b.stopPropagation();this.setDate();$dateLayerSelector.hide(0,function(){$(document).off("click.narusec-date-picker")})},this));this.$selector.find(".naru-calendar-icon,.naru-calendar-input").closest(".naru-calendar-wrapper").on("click",function(b){b.stopPropagation();let $wrapper=$(this);$dateLayerSelector.appendTo($wrapper);let content=objThis.$selector;let contentRight=content.offset().left+content.width();let dateLayerRight=$wrapper.offset().left+$dateLayerSelector.width();let wrapperHeight=$wrapper.height();let dateLayerPosition={top:wrapperHeight+"px"};if(dateLayerRight>contentRight){dateLayerPosition.left="";dateLayerPosition.right="0px"}else{dateLayerPosition.left="0px";dateLayerPosition.right=""}a(dateLayerPosition)});function a(b){$dateLayerSelector.css(b);if($dateLayerSelector.is(":visible")){}else{$stDateTimePicker.hide();$edDateTimePicker.hide();let today=moment().format(selectorPattern);if($stDateTimePicker.date()===null){$stDateTimePicker.date(today)}if($edDateTimePicker.date()===null){$edDateTimePicker.date(today)}$stDateTimePicker.show();$edDateTimePicker.show();$dateLayerSelector.show(0,function(){let eventHandler=function(c){if($(c.target).is("."+dateLayerClass,"."+dateLayerClass+" *")){return}objThis.setDate();$dateLayerSelector.hide(0,function(){$(document).off("click",eventHandler)})};$(document).on("click",eventHandler)})}}};